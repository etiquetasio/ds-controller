<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controller</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  height: 100vh;
  margin: 0;
  padding: 20px;
}
h2 { margin-bottom: 20px; }
button {
  margin: 5px;
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: limegreen;
  color: black;
}
button:hover { background: #32cd32; }
#url-form {
  display:flex;
  gap:10px;
  margin-top:20px;
  width:100%;
  max-width:500px;
}
#url-input {
  flex:1;
  padding:10px;
  border-radius:6px;
  border:none;
  font-size:14px;
}
#send-url {
  background: dodgerblue;
  color: white;
}
#send-url:hover { background: #1e90ff; }
</style>
</head>
<body>
<h2>Controller</h2>
<div id="buttons">
  <button onclick="send('qrcode','0')">QRCODE HIDE</button>
  <button onclick="send('qrcode','1')">QRCODE SHOW</button>
  <button onclick="send('container','0')">ROTATE 0</button>
  <button onclick="send('container','90')">ROTATE 90</button>
  <button onclick="send('container','180')">ROTATE 180</button>
  <button onclick="send('container','270')">ROTATE 270</button>
  <button onclick="send('link','1')">LINK</button>
  <button onclick="send('link','0')">UNLINK</button>
</div>

<!-- Campo para enviar URL -->
<form id="url-form" onsubmit="publishURL(event)">
  <input type="text" id="url-input" placeholder="Digite a URL para exibir no player..." />
  <button type="submit" id="send-url">Enviar URL</button>
</form>

<script>
const urlParams = new URLSearchParams(window.location.search);
const duid = urlParams.get("duid") || "teste-duid";
const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt");

client.on("connect", () => {
  console.log("Controller conectado ao MQTT com DUID:", duid);
});

function send(topic, value){
  client.publish(`${duid}/${topic}`, value);
  console.log(`Enviado -> ${duid}/${topic}: ${value}`);
}

function publishURL(event){
  event.preventDefault();
  const url = document.getElementById("url-input").value.trim();
  if(url){
    send("url", url);
    document.getElementById("url-input").value = "";
  }
}
</script>
</body>
</html>
